# frozen_string_literal: true

require 'rspec'

RSpec.describe Iguvium::CV do
  subject(:cv) { Iguvium::CV.new(path, page_index + 1) }

  context 'auction' do
    let(:path) { 'spec/files/auction.pdf' }
    let(:page_index) { 0 }

    let(:lines) { cv.lines }
    let(:boxes) { cv.boxes }

    it do
      expect(boxes)
        .to have_attributes(count: 7)
        .and eql(
          [
            [64..536, 326..427], [70..188, 434..439], [64..536, 476..536], [70..138, 542..547],
            [64..536, 578..610], [70..121, 617..622], [70..133, 669..721]
          ]
        )

      expect(lines[:vertical])
        .to have_attributes(count: 24)
        .and eql(
          [
            [66, 326..425], [534, 326..427], [253, 327..426], [440, 327..426], [160, 328..425], [347, 328..425],
            [74, 434..439], [66, 477..536], [222, 477..535], [378, 477..535], [534, 478..535], [74, 542..547],
            [66, 578..610], [253, 579..609], [440, 579..609], [534, 579..610], [160, 580..608], [347, 580..608],
            [74, 617..622], [81, 669..680], [122, 670..675], [108, 677..682], [88, 696..711], [116, 696..711]
          ]
        )
      expect(lines[:horizontal])
        .to have_attributes(count: 25)
        .and eql(
          [
            [64..534, 328], [65..535, 342], [64..535, 356], [64..535, 370], [64..535, 384],
            [64..535, 398], [66..536, 425], [70..188, 436], [68..532, 478], [66..534, 492],
            [65..535, 506], [64..536, 534], [70..138, 545], [64..532, 580], [66..534, 594],
            [64..536, 608], [70..121, 620], [90..96, 673], [107..126, 676], [71..78, 681],
            [84..132, 683], [103..108, 690], [78..86, 694], [80..86, 701], [95..108, 718]
          ]
        )
    end
  end

  context 'quote' do
    let(:path) { 'spec/files/quote.pdf' }
    let(:page_index) { 0 }

    let(:lines) { cv.lines }
    let(:boxes) { cv.boxes }

    it do
      expect(boxes)
        .to have_attributes(count: 5)
        .and eql(
          [
            [40..571, 34..442], [40..571, 460..465], [40..571, 494..499], [40..571, 658..663], [42..81, 716..755]
          ]
        )

      expect(lines[:vertical])
        .to have_attributes(count: 14)
        .and eql(
          [
            [42, 34..441], [167, 34..439], [323, 34..440], [378, 34..440], [417, 34..440],
            [472, 34..440], [513, 34..440], [568, 34..440], [44, 460..465], [44, 494..499],
            [44, 658..663], [53, 732..744], [64, 732..742], [70, 735..742]
          ]
        )
      expect(lines[:horizontal])
        .to have_attributes(count: 20)
        .and eql(
          [
            [41..570, 59], [41..570, 80], [41..570, 122], [41..570, 154], [41..570, 186],
            [41..570, 217], [41..570, 237], [41..570, 269], [41..570, 380], [41..570, 411],
            [41..569, 439], [40..571, 463], [40..571, 497], [40..571, 661], [44..56, 720],
            [63..74, 720], [51..66, 731], [63..70, 737], [51..61, 743], [71..78, 745]
          ]
        )
    end
  end
end
